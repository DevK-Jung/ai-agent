# μ„λ² λ”© κΈ°λ° κ²€μƒ‰ ν…μ¤νΈ

μ΄ λ””λ ‰ν† λ¦¬λ” BGE-M3 μ„λ² λ”©μ„ ν™μ©ν• κ²€μƒ‰ μ‹μ¤ν…μ μ„±λ¥μ„ ν‰κ°€ν•κ³  μµμ ν™”ν•κΈ° μ„ν• ν…μ¤νΈ ν™κ²½μ…λ‹λ‹¤.

## π“ νμΌ κµ¬μ΅°

```
embedding_tests/
β”β”€β”€ README.md                 # μ΄ νμΌ
β”β”€β”€ search_test.ipynb        # λ©”μΈ κ²€μƒ‰ ν…μ¤νΈ λ…ΈνΈλ¶
β”β”€β”€ performance_analysis.py  # μ„±λ¥ λ¶„μ„ μ¤ν¬λ¦½νΈ
β””β”€β”€ test_data/               # ν…μ¤νΈμ© λ°μ΄ν„°
```

## π§ ν…μ¤νΈ λ‚΄μ©

### 1. search_test.ipynb
**λ©”μΈ κ²€μƒ‰ μ„±λ¥ ν…μ¤νΈ λ…ΈνΈλ¶**

- **Cosine Similarity μΏΌλ¦¬ μ‘μ„±**: BGE-M3 μµμ ν™” μ„λ² λ”© ν™μ©
- **Top-K μ „λµ μ‹¤ν—**: k=1,3,5,10,20,50 λΉ„κµ
- **Threshold μ‹¤ν—**: 0.3~0.8 λ²”μ„ μ„±λ¥ μΈ΅μ •
- **BGE-M3 Prefix ν¨κ³Ό**: query/passage prefix μ„±λ¥ λΉ„κµ
- **μ„±λ¥ λ²¤μΉλ§ν¬**: μ†λ„ λ° λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μΈ΅μ •
- **μµμ  νλΌλ―Έν„° μ¶”μ²**: μΆ…ν•© λ¶„μ„ κ²°κ³Ό

## π€ μ‚¬μ© λ°©λ²•

### 1. ν™κ²½ μ„¤μ •
```bash
cd /Users/kimjunghyeon/Desktop/workspace/ai-agent
jupyter lab notebook/embedding/search_test.ipynb
```

### 2. ν•„μ” ν¨ν‚¤μ§€
```bash
pip install jupyter matplotlib seaborn pandas numpy
```

### 3. μ‹¤ν–‰ μμ„
1. **ν™κ²½ μ„¤μ • μ…€** μ‹¤ν–‰ (ν”„λ΅μ νΈ κ²½λ΅ μ„¤μ •)
2. **μ„λ² λ”© μ„λΉ„μ¤ μ΄κΈ°ν™”** 
3. **ν…μ¤νΈ λ°μ΄ν„° μ¤€λΉ„**
4. **κ° μ‹¤ν— λ‹¨κ³„** μμ°¨ μ‹¤ν–‰
5. **κ²°κ³Ό λ¶„μ„ λ° μ‹κ°ν™”**

## π“ μ£Όμ” μΈ΅μ • μ§€ν‘

### κ²€μƒ‰ ν’μ§
- **μ½”μ‚¬μΈ μ μ‚¬λ„ λ¶„ν¬**: μ „μ²΄ κ²€μƒ‰ ν’μ§ ν‰κ°€
- **Top-K μ •ν™•λ„**: μƒμ„ Kκ° κ²°κ³Όμ ν‰κ·  μ μ
- **Threshold ν¨κ³Όμ„±**: μ„κ³„κ°’λ³„ κ²°κ³Ό ν’μ§/μλ‰ κ· ν•

### μ„±λ¥ μ§€ν‘
- **μ„λ² λ”© μƒμ„± μ†λ„**: λ‹¨μΌ vs λ°°μΉ μ²λ¦¬ μ‹κ°„
- **κ²€μƒ‰ μ‘λ‹µ μ†λ„**: μ μ‚¬λ„ κ³„μ‚° λ° μμ„ν™” μ‹κ°„
- **λ©”λ¨λ¦¬ μ‚¬μ©λ‰**: λ¨λΈ λ΅λ”© λ° λ²΅ν„° μ €μ¥ κ³µκ°„

### BGE-M3 μµμ ν™” ν¨κ³Ό
- **Prefix ν¨κ³Ό**: "query:" vs "passage:" μ‚¬μ© μ „ν›„ λΉ„κµ
- **μ„±λ¥ κ°μ„ λ¥ **: κΈ°λ³Έ μ„λ² λ”© λ€λΉ„ κ°μ„  μ •λ„

## π― μμƒ κ²°κ³Ό

### μµμ  νλΌλ―Έν„° (μμƒ)
- **Top-K**: 5-10κ° (μ„±λ¥/ν¨μ¨μ„± κ· ν•)
- **Threshold**: 0.6-0.7 (ν’μ§/μλ‰ κ· ν•)
- **λ°°μΉ ν¬κΈ°**: 32 (μ†λ„ μµμ ν™”)
- **BGE-M3 Prefix**: ν•„μ μ‚¬μ© (10-20% μ„±λ¥ ν–¥μƒ)

### μ„±λ¥ λ²¤μΉλ§ν¬ (μμƒ)
- **λ‹¨μΌ μ„λ² λ”©**: ~50ms
- **λ°°μΉ μ„λ² λ”©**: ~1-2ms/document
- **κ²€μƒ‰ μ†λ„**: ~10-20ms (1000κ° λ¬Έμ„ λ€μƒ)
- **λ°°μΉ μ²λ¦¬ ν–¥μƒ**: 5-10x μ†λ„ κ°μ„ 

## π”§ ν™•μ¥ κ°€λ¥ν• ν…μ¤νΈ

### 1. μ‹¤μ  λ°μ΄ν„° ν…μ¤νΈ
```python
# ν”„λ΅λ•μ… λ°μ΄ν„°λ΅ ν…μ¤νΈ ν™•μ¥
real_documents = load_production_documents()
real_queries = load_real_user_queries()
```

### 2. ν•μ΄λΈλ¦¬λ“ κ²€μƒ‰ λΉ„κµ
```python
# ν‚¤μ›λ“ + μλ―Έμ  κ²€μƒ‰ μ„±λ¥ λΉ„κµ
hybrid_results = test_hybrid_search(queries, alpha=0.7)
```

### 3. A/B ν…μ¤νΈ μ¤€λΉ„
```python
# λ‹¤μ–‘ν• λ¨λΈ/μ„¤μ • λΉ„κµ
models_comparison = compare_embedding_models([
    'BGE-M3', 'sentence-t5', 'multilingual-e5'
])
```

## π“ κ²°κ³Ό ν™μ©

### 1. ν”„λ΅λ•μ… μ„¤μ • μµμ ν™”
- API μ—”λ“ν¬μΈνΈ κΈ°λ³Έκ°’ μ„¤μ •
- κ²€μƒ‰ ν’μ§ κΈ°μ¤€ μ„¤μ •
- μ„±λ¥ SLA μ •μ

### 2. λ¨λ‹ν„°λ§ κΈ°μ¤€μ„ 
- μ •μƒ μ„±λ¥ λ²”μ„ μ„¤μ •
- μ•λ¦Ό μ„κ³„κ°’ μ„¤μ •
- μ„±λ¥ μ €ν• κ°μ§€ λ΅μ§

### 3. μ§€μ†μ  κ°μ„ 
- μ •κΈ° λ²¤μΉλ§ν¬ μ‹¤ν–‰
- μ‚¬μ©μ ν”Όλ“λ°± λ¶„μ„
- νλΌλ―Έν„° νλ‹ μλ™ν™”

## π” λ””λ²„κΉ… κ°€μ΄λ“

### μΌλ°μ μΈ λ¬Έμ λ“¤

1. **λ¨λΈ λ΅λ”© μ‹¤ν¨**
```python
# GPU λ©”λ¨λ¦¬ λ¶€μ΅± μ‹ CPU μ‚¬μ©
embedding_service = BGEEmbeddingService(device="cpu")
```

2. **μ„λ² λ”© μ°¨μ› μ¤λ¥**
```python
# μ‹¤μ  λ¨λΈ μ°¨μ› ν™•μΈ
actual_dim = embedding_service.get_embedding_dimension()
print(f"λ¨λΈ μ°¨μ›: {actual_dim}")
```

3. **μ„±λ¥ μ €ν•**
```python
# λ°°μΉ ν¬κΈ° μ΅°μ •
embeddings = service.encode_passages(texts, batch_size=16)
```

## π“ μ°Έκ³  μλ£

- [BGE-M3 λ…Όλ¬Έ](https://arxiv.org/abs/2402.03216)
- [Sentence Transformers λ¬Έμ„](https://www.sbert.net/)
- [pgvector λ²΅ν„° κ²€μƒ‰ μµμ ν™”](https://github.com/pgvector/pgvector)

---

π’΅ **Tip**: ν…μ¤νΈ κ²°κ³Όλ¥Ό λ°”νƒ•μΌλ΅ `app/core/config.py`μ κΈ°λ³Έκ°’μ„ μµμ ν™”ν•μ„Έμ”!