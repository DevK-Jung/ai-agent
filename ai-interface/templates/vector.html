<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Search & Document Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            overflow: hidden;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-2px);
        }

        .main-content {
            flex: 1;
            display: flex;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        .left-panel {
            width: 40%;
            padding: 30px;
            border-right: 1px solid #e1e8ed;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .right-panel {
            width: 60%;
            padding: 30px;
            overflow-y: auto;
            background: white;
        }

        .panel-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4caf50;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: white;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4caf50;
        }

        input[type="file"] {
            padding: 8px;
            border: 2px dashed #e1e8ed;
            background: #f8f9fa;
            cursor: pointer;
        }

        input[type="file"]:hover {
            border-color: #4caf50;
            background: #e8f5e8;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .document-item {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .document-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-color: #4caf50;
        }

        .document-content {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .document-metadata {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }

        .search-result {
            border-left: 4px solid #4caf50;
            padding-left: 15px;
        }

        .score {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-left: 10px;
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #363;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .status-indicator {
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .collection-selector {
            margin-bottom: 15px;
        }

        .small-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }

            .left-panel, .right-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e1e8ed;
            }

            .left-panel {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <button class="back-button" onclick="window.location.href='/'">
            ‚Üê ÌôàÏúºÎ°ú
        </button>
        <h1>üîç Vector Search & Document Management</h1>
        <div style="width: 88px;"></div>
    </header>

    <main class="main-content">
        <!-- Ï¢åÏ∏° Ìå®ÎÑê: ÏóÖÎ°úÎìú Î∞è Í≤ÄÏÉâ -->
        <div class="left-panel">
            <div class="panel-title">üìÑ Î¨∏ÏÑú Í¥ÄÎ¶¨ & Í≤ÄÏÉâ</div>

            <!-- ÏÉÅÌÉú ÌëúÏãú -->
            <div id="status-indicator" class="status-indicator">
                <span id="vector-status">üîç Î≤°ÌÑ∞ ÏÑúÎπÑÏä§ ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...</span>
            </div>

            <!-- Ïª¨Î†âÏÖò ÏÑ†ÌÉù -->
            <div class="section">
                <div class="section-title">üìö Ïª¨Î†âÏÖò Í¥ÄÎ¶¨</div>
                <div class="form-group">
                    <label for="collection-name">Ïª¨Î†âÏÖò Ïù¥Î¶Ñ</label>
                    <select id="collection-name">
                        <option value="">Í∏∞Î≥∏ Ïª¨Î†âÏÖò</option>
                    </select>
                    <div class="small-text">Î¨∏ÏÑúÎ•º Í∑∏Î£πÌôîÌï† Ïª¨Î†âÏÖòÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÏÉàÎ°ú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî</div>
                </div>
                <div class="form-group">
                    <input type="text" id="new-collection" placeholder="ÏÉà Ïª¨Î†âÏÖò Ïù¥Î¶Ñ">
                    <button class="btn-secondary" onclick="createCollection()" style="margin-top: 10px;">
                        ‚ûï Ïª¨Î†âÏÖò ÏÉùÏÑ±
                    </button>
                </div>
            </div>

            <!-- Î¨∏ÏÑú ÏóÖÎ°úÎìú -->
            <div class="section">
                <div class="section-title">üìÅ Î¨∏ÏÑú ÏóÖÎ°úÎìú</div>
                <div class="form-group">
                    <label for="upload-file">ÌååÏùº ÏÑ†ÌÉù (PDF, TXT, MD, HTML)</label>
                    <input type="file" id="upload-file" accept=".pdf,.txt,.md,.html,.htm">
                    <div class="small-text">ÏµúÎåÄ 10MB, PDF/TXT/MD/HTML ÌååÏùº ÏßÄÏõê</div>
                </div>
                <div class="form-group">
                    <label for="chunk-size">Ï≤≠ÌÅ¨ ÌÅ¨Í∏∞</label>
                    <input type="number" id="chunk-size" value="1000" min="100" max="5000">
                </div>
                <div class="form-group">
                    <label for="chunk-overlap">Ï≤≠ÌÅ¨ Í≤πÏπ®</label>
                    <input type="number" id="chunk-overlap" value="200" min="0" max="1000">
                </div>
                <button class="btn-primary" onclick="uploadDocument()">
                    üì§ Î¨∏ÏÑú ÏóÖÎ°úÎìú
                </button>
            </div>

            <!-- ÌÖçÏä§Ìä∏ ÏßÅÏ†ë ÏûÖÎ†• -->
            <div class="section">
                <div class="section-title">‚úèÔ∏è ÌÖçÏä§Ìä∏ ÏßÅÏ†ë ÏûÖÎ†•</div>
                <div class="form-group">
                    <label for="text-title">Î¨∏ÏÑú Ï†úÎ™©</label>
                    <input type="text" id="text-title" placeholder="Î¨∏ÏÑú Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="text-content">ÎÇ¥Ïö©</label>
                    <textarea id="text-content" placeholder="ÌÖçÏä§Ìä∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." rows="5"></textarea>
                </div>
                <button class="btn-primary" onclick="uploadTextDocument()">
                    üíæ ÌÖçÏä§Ìä∏ Ï†ÄÏû•
                </button>
            </div>

            <!-- Í≤ÄÏÉâ -->
            <div class="section">
                <div class="section-title">üîç Î¨∏ÏÑú Í≤ÄÏÉâ</div>
                <div class="form-group">
                    <label for="search-query">Í≤ÄÏÉâÏñ¥</label>
                    <textarea id="search-query" placeholder="Ï∞æÍ≥†Ïûê ÌïòÎäî ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="search-limit">Í≤∞Í≥º Ïàò</label>
                    <select id="search-limit">
                        <option value="5">5Í∞ú</option>
                        <option value="10">10Í∞ú</option>
                        <option value="20">20Í∞ú</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="score-threshold">Ï†êÏàò ÏûÑÍ≥ÑÍ∞í (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                    <input type="number" id="score-threshold" placeholder="0.0 ~ 1.0" step="0.1" min="0" max="1">
                </div>
                <button class="btn-secondary" onclick="searchDocuments()">
                    üîç Í≤ÄÏÉâ Ïã§Ìñâ
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Ï≤òÎ¶¨ Ï§ë...</p>
            </div>
        </div>

        <!-- Ïö∞Ï∏° Ìå®ÎÑê: Í≤∞Í≥º ÌëúÏãú -->
        <div class="right-panel">
            <div class="panel-title">üìã Í≤∞Í≥º</div>
            <div id="results"></div>
        </div>
    </main>
</div>

<script>
    let collections = [];

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
        checkVectorStatus();
        loadCollections();

        // ÌååÏùº ÏÑ†ÌÉù Ïãú ÌîºÎìúÎ∞±
        document.getElementById('upload-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileInput = e.target;

            if (file) {
                fileInput.style.borderColor = '#4caf50';
                fileInput.style.backgroundColor = '#e8f5e8';

                if (file.size > 10 * 1024 * 1024) {
                    showError('ÌååÏùº ÌÅ¨Í∏∞Í∞Ä 10MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§.');
                    fileInput.value = '';
                    fileInput.style.borderColor = '#f44336';
                    fileInput.style.backgroundColor = '#fdf2f2';
                    return;
                }
            } else {
                fileInput.style.borderColor = '#e1e8ed';
                fileInput.style.backgroundColor = '#f8f9fa';
            }
        });
    });

    // Î≤°ÌÑ∞ ÏÑúÎπÑÏä§ ÏÉÅÌÉú ÌôïÏù∏
    async function checkVectorStatus() {
        try {
            const response = await fetch('/api/v1/vector/status');
            const data = await response.json();

            if (response.ok) {
                document.getElementById('vector-status').innerHTML =
                    `‚úÖ Î≤°ÌÑ∞ ÏÑúÎπÑÏä§ ÌôúÏÑ± (Ïª¨Î†âÏÖò: ${data.collections || 0}Í∞ú, Î¨∏ÏÑú: ${data.documents || 0}Í∞ú)`;
            } else {
                document.getElementById('vector-status').innerHTML = '‚ùå Î≤°ÌÑ∞ ÏÑúÎπÑÏä§ Ïó∞Í≤∞ Ïã§Ìå®';
            }
        } catch (error) {
            document.getElementById('vector-status').innerHTML = '‚ùå Î≤°ÌÑ∞ ÏÑúÎπÑÏä§ Ïó∞Í≤∞ Ïã§Ìå®';
        }
    }

    // Ïª¨Î†âÏÖò Î™©Î°ù Î°úÎìú
    async function loadCollections() {
        try {
            const response = await fetch('/api/v1/vector/collections');
            const data = await response.json();

            if (response.ok) {
                collections = data.collections;
                updateCollectionSelector();
            }
        } catch (error) {
            console.error('Ïª¨Î†âÏÖò Î°úÎìú Ïã§Ìå®:', error);
        }
    }

    // Ïª¨Î†âÏÖò ÏÑ†ÌÉùÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏
    function updateCollectionSelector() {
        const selector = document.getElementById('collection-name');
        selector.innerHTML = '<option value="">Í∏∞Î≥∏ Ïª¨Î†âÏÖò</option>';

        collections.forEach(collection => {
            const option = document.createElement('option');
            option.value = collection;
            option.textContent = collection;
            selector.appendChild(option);
        });
    }

    // Ïª¨Î†âÏÖò ÏÉùÏÑ±
    async function createCollection() {
        const name = document.getElementById('new-collection').value.trim();
        if (!name) {
            showError('Ïª¨Î†âÏÖò Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
            return;
        }

        showLoading();
        try {
            const response = await fetch(`/api/v1/vector/collections/${encodeURIComponent(name)}`, {
                method: 'POST'
            });
            const data = await response.json();

            if (response.ok) {
                showSuccess(data.message);
                document.getElementById('new-collection').value = '';
                loadCollections();
            } else {
                showError(data.detail || 'Ïª¨Î†âÏÖò ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        } catch (error) {
            showError('Ïª¨Î†âÏÖò ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        } finally {
            hideLoading();
        }
    }

    // ÌååÏùº Î¨∏ÏÑú ÏóÖÎ°úÎìú
    async function uploadDocument() {
        const fileInput = document.getElementById('upload-file');
        const file = fileInput.files[0];

        if (!file) {
            showError('ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        const collectionName = document.getElementById('collection-name').value;
        const chunkSize = document.getElementById('chunk-size').value;
        const chunkOverlap = document.getElementById('chunk-overlap').value;

        let url = '/api/v1/vector/documents/file';
        const params = new URLSearchParams();
        if (collectionName) params.append('collection_name', collectionName);
        if (chunkSize) params.append('chunk_size', chunkSize);
        if (chunkOverlap) params.append('chunk_overlap', chunkOverlap);

        if (params.toString()) {
            url += '?' + params.toString();
        }

        showLoading();
        try {
            const response = await fetch(url, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            if (response.ok) {
                showSuccess(`Î¨∏ÏÑú ÏóÖÎ°úÎìú ÏÑ±Í≥µ! ${data.chunks_count}Í∞ú Ï≤≠ÌÅ¨Î°ú Î∂ÑÌï†ÎêòÏóàÏäµÎãàÎã§.`);
                fileInput.value = '';
                fileInput.style.borderColor = '#e1e8ed';
                fileInput.style.backgroundColor = '#f8f9fa';
                checkVectorStatus();
            } else {
                showError(data.detail || 'Î¨∏ÏÑú ÏóÖÎ°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        } catch (error) {
            showError('Î¨∏ÏÑú ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        } finally {
            hideLoading();
        }
    }

    // ÌÖçÏä§Ìä∏ Î¨∏ÏÑú ÏóÖÎ°úÎìú
    async function uploadTextDocument() {
        const title = document.getElementById('text-title').value.trim();
        const content = document.getElementById('text-content').value.trim();

        if (!title || !content) {
            showError('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
            return;
        }

        const collectionName = document.getElementById('collection-name').value;

        showLoading();
        try {
            let url = '/api/v1/vector/documents/text';
            if (collectionName) {
                url += `?collection_name=${encodeURIComponent(collectionName)}`;
            }

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    content: content,
                    metadata: { title: title }
                })
            });
            const data = await response.json();

            if (response.ok) {
                showSuccess(`ÌÖçÏä§Ìä∏ Î¨∏ÏÑú Ï†ÄÏû• ÏÑ±Í≥µ! ${data.chunks_count}Í∞ú Ï≤≠ÌÅ¨Î°ú Î∂ÑÌï†ÎêòÏóàÏäµÎãàÎã§.`);
                document.getElementById('text-title').value = '';
                document.getElementById('text-content').value = '';
                checkVectorStatus();
            } else {
                showError(data.detail || 'ÌÖçÏä§Ìä∏ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        } catch (error) {
            showError('ÌÖçÏä§Ìä∏ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        } finally {
            hideLoading();
        }
    }

    // Î¨∏ÏÑú Í≤ÄÏÉâ
    async function searchDocuments() {
        const query = document.getElementById('search-query').value.trim();
        if (!query) {
            showError('Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
            return;
        }

        const collectionName = document.getElementById('collection-name').value;
        const limit = parseInt(document.getElementById('search-limit').value);
        const scoreThreshold = parseFloat(document.getElementById('score-threshold').value) || null;

        showLoading();
        try {
            const response = await fetch('/api/v1/vector/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    query: query,
                    k: limit,
                    collection_name: collectionName,
                    score_threshold: scoreThreshold
                })
            });
            const data = await response.json();

            if (response.ok) {
                console.log('Í≤ÄÏÉâ ÏùëÎãµ:', data); // ÎîîÎ≤ÑÍπÖÏö© Î°úÍ∑∏
                showSearchResults(data);
            } else {
                console.error('Í≤ÄÏÉâ Ïò§Î•ò:', data); // ÎîîÎ≤ÑÍπÖÏö© Î°úÍ∑∏
                showError(data.detail || 'Í≤ÄÏÉâÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        } catch (error) {
            showError('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        } finally {
            hideLoading();
        }
    }

    // Í≤ÄÏÉâ Í≤∞Í≥º ÌëúÏãú
    function showSearchResults(data) {
        const resultsDiv = document.getElementById('results');

        // ÏùëÎãµ Íµ¨Ï°∞Ïóê Îî∞Îùº results ÎòêÎäî documents Î∞∞Ïó¥ ÌôïÏù∏
        const results = data.results || data.documents || [];

        if (results.length === 0) {
            resultsDiv.innerHTML = `
                <div class="result-box">
                    <div class="result-title">üîç Í≤ÄÏÉâ Í≤∞Í≥º</div>
                    <p>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                    <div class="small-text">Í≤ÄÏÉâÏñ¥: "${data.query || 'Ïïå Ïàò ÏóÜÏùå'}"</div>
                    ${data.execution_time_ms ? `<div class="small-text">Ïã§Ìñâ ÏãúÍ∞Ñ: ${data.execution_time_ms}ms</div>` : ''}
                </div>
            `;
            return;
        }

        let html = `
            <div class="result-box">
                <div class="result-title">üîç Í≤ÄÏÉâ Í≤∞Í≥º (${results.length}Í∞ú)</div>
                <div class="small-text" style="margin-bottom: 15px;">
                    Í≤ÄÏÉâÏñ¥: "${data.query || 'Ïïå Ïàò ÏóÜÏùå'}" |
                    Ïã§Ìñâ ÏãúÍ∞Ñ: ${data.execution_time_ms ? Math.round(data.execution_time_ms) + 'ms' : 'N/A'} |
                    Ïª¨Î†âÏÖò: ${data.collection_name || 'Í∏∞Î≥∏'}
                </div>
        `;

        results.forEach((doc, index) => {
            const score = doc.score ? (doc.score * 100).toFixed(1) + '%' : 'N/A';

            // Î©îÌÉÄÎç∞Ïù¥ÌÑ∞Î•º Î≥¥Í∏∞ Ï¢ãÍ≤å Ìè¨Îß∑
            let metadataHtml = 'Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÏóÜÏùå';
            if (doc.metadata) {
                const importantFields = ['filename', 'file_type', 'chunk_index', 'total_chunks'];
                const otherFields = Object.keys(doc.metadata).filter(key => !importantFields.includes(key));

                const importantMeta = importantFields
                    .filter(key => doc.metadata[key] !== undefined)
                    .map(key => `<strong>${key}:</strong> ${doc.metadata[key]}`)
                    .join(' | ');

                metadataHtml = importantMeta;

                if (otherFields.length > 0) {
                    const otherMeta = otherFields
                        .map(key => `<strong>${key}:</strong> ${doc.metadata[key]}`)
                        .join(' | ');
                    metadataHtml += otherMeta ? '<br>' + otherMeta : '';
                }
            }

            html += `
                <div class="document-item search-result">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong>Í≤∞Í≥º ${index + 1}</strong>
                        <span class="score">${score}</span>
                    </div>
                    <div class="document-content">${escapeHtml(doc.content)}</div>
                    <div class="document-metadata">
                        ${metadataHtml}
                    </div>
                    ${doc.document_id ? `<div class="small-text">Î¨∏ÏÑú ID: ${doc.document_id}</div>` : ''}
                </div>
            `;
        });

        html += '</div>';
        resultsDiv.innerHTML = html;
    }

    // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
    function showLoading() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').innerHTML = '';
    }

    function hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }

    function showError(message) {
        hideLoading();
        document.getElementById('results').innerHTML =
            `<div class="error">‚ùå Ïò§Î•ò: ${message}</div>`;
    }

    function showSuccess(message) {
        const successDiv = document.createElement('div');
        successDiv.className = 'success';
        successDiv.innerHTML = `‚úÖ ${message}`;
        document.getElementById('results').appendChild(successDiv);

        setTimeout(() => {
            successDiv.remove();
        }, 5000);
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Enter ÌÇ§Î°ú Í≤ÄÏÉâ
    document.getElementById('search-query').addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            searchDocuments();
        }
    });
</script>
</body>
</html>